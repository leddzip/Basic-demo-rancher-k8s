image_name = leddzip/demo-rancher-back-connected-service-java-1
app_name = $$(cat pom.xml | xq .project.artifactId | tr -d \")
version = $$(cat pom.xml | xq .project.version | tr -d \")

docker-clean:
	rm -f Dockerfile

docker-generate: docker-clean
	echo "# THIS FILE IS AUTOMATICALLY GENERATED !" >> Dockerfile
	echo "# DO NOT EDIT THIS FILE MANUALLY !" >> Dockerfile
	echo "# IF YOU MUST CHANGE THE CONTENT OF HTE DOCKERFILE, CHANGE THE FILE TEMPLATE.DOCKERFILE INSTEAD !" >> Dockerfile
	sed -e s/{{name}}/$(app_name)/g template.dockerfile | sed -e s/{{version}}/$(version)/g >> Dockerfile

docker-build: docker-generate
	docker build -t $(image_name):$(version) -t $(image_name) .

docker-push: docker-build
	docker push $(image_name):$(version)
	docker push $(image_name)

